<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://usetrmnl.com/css/latest/plugins.css">
    <script src="https://usetrmnl.com/js/latest/plugins.js"></script>
    <style>
        .position {
            display: inline;
            color: transparent;
            width: 140px;
        }


        td:has(.position) {
            width: 14px;
        }

        td:has(.positionNumber) {
            width: 24px;
        }

        td:has(.ptsNumber) {
            width: 24px;
        }

        .ptsNumber {
            text-align: right;
        }

        td:has(.teamName) {
            width: 96px;
        }

        .standings-col4 {
            display: block;
            margin-bottom: 20px;
        }
    </style>
</head>

<body class="environment trmnl">
    <div class="screen">
        <div class="view view--full">
            <div class="layout">

                <div>

                    <div class="grid grid--cols-4">
                        <table class="table table--condensed">
                            <tbody class="standings-col1"></tbody>
                        </table>
                        <table class="table table--condensed">
                            <tbody class="standings-col2"></tbody>
                        </table>
                        <table class="table table--condensed">
                            <tbody class="standings-col3"></tbody>
                        </table>
                        <table class="table table--condensed">
                            <tbody class="standings-col4"></tbody>
                        </table>
                    </div>
                </div>


            </div>
            <div class="title_bar">
                <img class="image image-stroke image-stroke--small"
                    src="https://filedn.eu/lm9kmI3DGyeXIWHOXT8UUwH/TRMNL/logo.png" />
                <span class="title">Bundesliga</span>
                <span class="instance seasonName"></span>
            </div>

        </div>
    </div>

    <script>
        const COLORS = {
            championsLeague: "bg--gray-1",
            europaLeague: "bg--gray-4",
            conferenceLeague: "bg--gray-6",
            rest: "",
            relegation: "bg--gray-6",
            relegated: "bg--gray-1"
        };

        function getRowColor(position) {
            if (position < 4) return COLORS.championsLeague;
            if (position < 5) return COLORS.europaLeague;
            if (position < 6) return COLORS.conferenceLeague;
            if (position < 15) return COLORS.rest;
            if (position < 16) return COLORS.relegation;
            return COLORS.relegated;
        }

        function createRow(team, position) {
            const row = document.createElement('tr');
            row.innerHTML = `
        <td><div class="position ${getRowColor(position)}">-</div></td>
        <td><span class="positionNumber label label--small">${position + 1}.</span></td>
        <td><span class="teamName label label--small">${team.shortName}</span></td>
        <td><span class="label label--small ptsNumber">${team.points}</span></td>
    `;
            return row;
        }

        const currentYear = new Date().getFullYear();
        if (new Date().getMonth() < 7) {
            currentYear -= 1;
        }
        const seasonName = document.querySelector('.seasonName');
        seasonName.textContent = `Saison ${currentYear}/${currentYear + 1}`;

        fetch(`https://api.openligadb.de/getbltable/bl1/${currentYear}`)
            .then(res => res.json())
            .then(data => {
                const cols = [
                    document.querySelector('.standings-col1'),
                    document.querySelector('.standings-col2'),
                    document.querySelector('.standings-col3'),
                    document.querySelector('.standings-col4')
                ];
                cols.forEach(col => col.innerHTML = '');

                const perCol = Math.ceil(data.length / 4);

                data.forEach((team, index) => {
                    const row = createRow(team, index);
                    const colIndex = Math.floor(index / perCol);
                    cols[colIndex].appendChild(row);
                });
            })
            .catch(console.error);


        function createMatchRow(match) {

        }


        fetch("https://api.openligadb.de/getmatchdata/bl1")
            .then(res => res.json())
            .then(data => {
                const spieltag = document.querySelector('.spieltag');
                const firstDate = new Date(data[0].matchDateTime);
                const lastDate = new Date(data[data.length - 1].matchDateTime);
                data.forEach((match, index) => {
                    spieltag.textContent = `${match.group.groupName} (${firstDate.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" })} - ${lastDate.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" })})`;
                });
            })
            .catch(console.error);
    </script>
</body>

</html>